{% extends 'base.html' %}

{% block title %}Dashboard - ProgressPulse{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>Welcome, {{ user.username }}!</h1>
    <p>Today is {{ today }}. Track your progress and reflect on your day.</p>
    
    <div class="progress-summary">
        <h2>Today's Progress</h2>
        <div class="progress-circle" data-percentage="{{ completion_percentage }}">
            <span class="progress-text">{{ completed_habits }}/{{ total_habits }}</span>
        </div>
        <p>{{ completion_percentage|floatformat:0 }}% of habits completed today</p>
    </div>
    
    <div class="dashboard-sections">
        <div class="section">
            <h2>Today's Habits</h2>
            {% if habits %}
                <ul class="habits-list">
                    {% for habit in habits %}
                        <li class="habit-item {% if habit.completed_today %}completed{% endif %}">
                            <div class="habit-check">
                                <form action="{% url 'habits:toggle_completion' habit.pk %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="check-btn {% if habit.completed_today %}checked{% endif %}">
                                        {% if habit.completed_today %}✓{% endif %}
                                    </button>
                                </form>
                            </div>
                            <div class="habit-info">
                                <h3>{{ habit.name }}</h3>
                                <p>{{ habit.description }}</p>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                <p><a href="{% url 'habits:habit_list' %}">Manage all habits →</a></p>
            {% else %}
                <p>You haven't created any habits yet.</p>
                <a href="{% url 'habits:habit_create' %}" class="btn btn-secondary">Create Your First Habit</a>
            {% endif %}
        </div>
        
        <div class="section">
            <h2>Today's Journal</h2>
            {% if todays_entry %}
                <div class="todays-entry">
                    <h3>Your entry for today:</h3>
                    <div class="entry-preview">
                        {{ todays_entry.content|truncatewords:30 }}
                    </div>
                    <a href="{% url 'journals:entry_update' todays_entry.pk %}" class="btn btn-secondary">Edit Entry</a>
                </div>
            {% else %}
                <p>You haven't written a journal entry today.</p>
                <a href="{% url 'journals:entry_create' %}" class="btn btn-secondary">Write Journal Entry</a>
            {% endif %}
            
            <div class="journal-links">
                <p><a href="{% url 'journals:entry_list' %}">View all journal entries →</a></p>
            </div>
        </div>
    </div>
</div>
<div class="quick-links">
    <h2>Quick Access</h2>
    <div class="link-cards">
        <a href="{% url 'core:calendar' %}" class="link-card">
            <h3>View Progress Calendar</h3>
            <p>See your habit and journal history</p>
        </a>
        <a href="{% url 'habits:habit_list' %}" class="link-card">
            <h3>Manage Habits</h3>
            <p>Add, edit, or remove habits</p>
        </a>
        <a href="{% url 'journals:entry_list' %}" class="link-card">
            <h3>Journal Entries</h3>
            <p>Read and edit your journal</p>
        </a>
    </div>
</div>
<div class="daily-quote">
    <h2>Today's Inspiration</h2>
    <blockquote>
        <p>"{{ daily_quote.content }}"</p>
        <footer>- {{ daily_quote.author }}</footer>
    </blockquote>
</div>
{% endblock %}